# .github/workflows/daily_ip_classifier.yml
name: Daily IP Classification

on:
  # æ¯å¤© UTC æ—¶é—´ 0 ç‚¹è‡ªåŠ¨è¿è¡Œ (UTC 00:00 ç›¸å½“äºåŒ—äº¬æ—¶é—´æ—©ä¸Š 8 ç‚¹)
  schedule:
    - cron: '0 * * * *'
  # å…è®¸åœ¨ GitHub Actions ç•Œé¢æ‰‹åŠ¨è§¦å‘æ­¤å·¥ä½œæµ
  workflow_dispatch:

jobs:
  classify-and-commit:
    runs-on: ubuntu-latest
    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä½ çš„ä»“åº“ä»£ç 
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }} 

      # æ­¥éª¤ 2: è®¾ç½® Python ç¯å¢ƒ
      - name: âš™ï¸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # æ­¥éª¤ 3: ä¸‹è½½æœ€æ–°çš„ all.txt æ–‡ä»¶ (æ–‡ä»¶ä¼šä¸‹è½½åˆ°è¿è¡Œç¯å¢ƒä¸­ï¼Œä½†ä¸ä¼šæäº¤åˆ°ä»“åº“)
      - name: ğŸ“¥ Download all.txt
        run: |
          curl -o all.txt https://raw.githubusercontent.com/PBH-BTN/BTN-Collected-Rules/main/combine/all.txt

      # æ­¥éª¤ 4: è¿è¡Œ Python è„šæœ¬è¿›è¡Œåˆ†ç±»å’Œæå–
      - name: ğŸ§ª Run Classification Script
        run: python classify_and_extract_ips.py
        
      # æ­¥éª¤ 5: è‡ªåŠ¨æäº¤ç”Ÿæˆçš„å››ä¸ª .txt æ–‡ä»¶
      - name: â¬†ï¸ Commit and Push Results
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "Automatic: Update classified IP lists"
          # ã€å…³é”®ä¿®æ”¹ã€‘æ˜ç¡®æŒ‡å®šè¦æäº¤çš„æ–‡ä»¶ï¼Œä»è€Œæ’é™¤ all.txt
          file_pattern: |
            ipv4_addresses_only.txt
            ipv4_cidr_only.txt
            ipv6_addresses_only.txt
            ipv6_cidr_only.txt
          commit_user_name: "GitHub Actions Bot"
          commit_user_email: "actions@github.com"
